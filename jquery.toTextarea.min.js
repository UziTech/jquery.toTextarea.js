
(function(d,f,h,c){var i=function(k,n){var l=null;if(h.body.createTextRange!==c){l=h.body.createTextRange();l.moveToPoint(k,n);l.select();l=f.getSelection().getRangeAt(0)}else{if(h.createRange!==c){if(h.caretPositionFromPoint){var m=h.caretPositionFromPoint(k,n);l=h.createRange();l.setStart(m.offsetNode,m.offset);l.collapse(true)}else{if(h.caretRangeFromPoint){l=h.caretRangeFromPoint(k,n)}}}}return l};var e=function(m){for(var k=m.length-1;k>=0;k--){if(m[k].childNodes.length>0){var l=e(m[k].childNodes);if(l!==null){return l}else{continue}}else{if(m[k].data!==""){return m[k]}}}return null};var b=function(u,t,r){var l=f.getSelection();var p=u.substring(u.length-1);var s=d(this).text();var m=h.createTextNode("\n");var v=null,k=null;if(s!==""){v=s.substring(s.length-1);k=e(this.childNodes)}var n=(p==="\n"&&v!=="\n"&&(v===null||(l.anchorNode===k&&l.anchorOffset===k.length)||(l.focusNode===k&&l.focusOffset===k.length)));var o=h.createTextNode(u);var q=null;if(t!==c&&r!==c){q=i(t,r)}else{q=l.getRangeAt(0)}q.deleteContents();if(n){q.insertNode(m)}q.insertNode(o);q=h.createRange();q.setStartAfter(o);q.collapse(true);l.removeAllRanges();l.addRange(q)};var a=function(o,r,q){var l=f.getSelection();var s=h.createElement("div");s.innerHTML=o;var m=s.childNodes;var p=null;if(r!==c&&q!==c){p=i(r,q)}else{p=l.getRangeAt(0)}p.deleteContents();var k=null;for(var n=0;n<m.length;n++){k=m[n];p.insertNode(k)}p=h.createRange();p.setStartAfter(k);p.collapse(true);l.removeAllRanges();l.addRange(p)};var j=function(n,m,l){var o=d(this);var k=new FileReader();k.onload=function(p){var q=new Image();q.onload=function(){var s=f.getSelection();var r=i(m,l);if(r!==null){r.insertNode(this);r.collapse(false);s.removeAllRanges();s.addRange(r)}else{if(o.is(":focus")){r=s.getRangeAt(0);r.collapse(false);r.insertNode(this);r.collapse(false);s.removeAllRanges();s.addRange(r)}else{o.append(this)}}};q.onerror=function(){alert("Not an image")};q.src=p.target.result};k.readAsDataURL(n)};var g=function(){if(h.body.createTextRange){var k=h.body.createTextRange();k.moveToElementText(this);k.select()}else{if(f.getSelection){var l=f.getSelection();var k=h.createRange();k.selectNodeContents(this);l.removeAllRanges();l.addRange(k)}}};d.fn.toTextarea=function(k){if(k==="destroy"||k===true){return this.each(function(){var m=d(this);if(m.data().isTextarea){if(this.id){d("label[for='"+this.id+"']").off(".toTextarea")}m.prop({contentEditable:false}).off(".toTextarea").data({isTextarea:false}).removeClass("toTextarea-disabled toTextarea-placeholder toTextarea")}})}else{if(k==="disable"){return this.each(function(){var m=d(this);if(m.data().isTextarea&&!m.data().disabled){if(this.id){d("label[for='"+this.id+"']").off(".toTextarea")}m.prop({contentEditable:false}).data({disabled:true}).addClass("toTextarea-disabled")}})}else{if(k==="enable"){return this.each(function(){var m=d(this);if(m.data().isTextarea&&m.data().disabled){if(this.id){d("label[for='"+this.id+"']").on("click.toTextarea",function(){m.focus()})}m.prop({contentEditable:true}).data({disabled:false}).removeClass("toTextarea-disabled")}})}else{var l={allowHTML:false,allowImg:false,singleLine:false,pastePlainText:true,placeholder:false};if(d.isPlainObject(k)){d.extend(l,k)}return this.each(function(){var p=d(this);var s=p.data().isTextarea||false;if(!s){if(this.id){d("label[for='"+this.id+"']").on("click.toTextarea",function(){p.focus()})}var r=l.allowHTML;if(typeof l.allowHTML==="function"){r=l.allowHTML.call(this)}var o=l.allowImg;if(typeof l.allowImg==="function"){o=l.allowImg.call(this)}var m=l.singleLine;if(typeof l.singleLine==="function"){m=l.singleLine.call(this)}var n=l.pastePlainText;if(typeof l.pastePlainText==="function"){n=l.pastePlainText.call(this)}var q=l.placeholder;if(typeof l.placeholder==="function"){q=l.placeholder.call(this)}if(!q){q=p.attr("placeholder")||p.data().placeholder}p.addClass("toTextarea").prop({contentEditable:true}).data({isTextarea:true,disabled:false}).on("select.toTextarea",function(){if(!d(this).data().disabled){g.call(this)}}).on("keypress.toTextarea keyup.toTextarea",function(){d(this).trigger("input")});if(q){p.attr({"data-placeholder":q}).addClass("toTextarea-placeholder")}if(m){p.addClass("toTextarea-singleLine").on("keypress.toTextarea",function(t){if(!d(this).data().disabled&&t.which===13){t.preventDefault();return false}});p.on("paste.toTextarea",function(t){if(!d(this).data().disabled){var u=null;if(f.clipboardData){u=f.clipboardData.getData("Text")}else{if(t.originalEvent.clipboardData){u=t.originalEvent.clipboardData.getData("text/plain")}else{return true}}u=u.replace(/[\n]/g," ");b.call(this,u);t.preventDefault();d(this).trigger("input");return false}}).on("drop.toTextarea",function(t){if(!d(this).data().disabled){var u=null;u=t.originalEvent.dataTransfer.getData("text");u=u.replace(/[\n]/g," ");b.call(this,u,t.originalEvent.clientX,t.originalEvent.clientY);t.preventDefault();d(this).trigger("input");return false}})}else{p.on("keypress.toTextarea",function(t){if(!d(this).data().disabled&&t.which===13){b.call(this,"\n");t.preventDefault();return false}});if(!r||n){p.on("paste.toTextarea",function(t){if(!d(this).data().disabled){var u=null;if(f.clipboardData){u=f.clipboardData.getData("Text")}else{if(t.originalEvent.clipboardData){u=t.originalEvent.clipboardData.getData("text/plain")}else{return true}}b.call(this,u);t.preventDefault();d(this).trigger("input");return false}}).on("drop.toTextarea",function(t){if(!d(this).data().disabled){var u=null;u=t.originalEvent.dataTransfer.getData("text");b.call(this,u,t.originalEvent.clientX,t.originalEvent.clientY);t.preventDefault();d(this).trigger("input");return false}})}}if(o){p.on("drop.toTextarea",function(v){if(!d(this).data().disabled&&v.originalEvent.dataTransfer.files.length>0){for(var t=0,u=v.originalEvent.dataTransfer.files.length;t<u;t++){j.call(this,v.originalEvent.dataTransfer.files[t],v.originalEvent.clientX,v.originalEvent.clientY)}v.preventDefault();d(this).trigger("input");return false}}).on("dragover.toTextarea",function(t){if(!d(this).data().disabled&&t.originalEvent.dataTransfer.types.length>0&&t.originalEvent.dataTransfer.types[0]==="Files"){t.preventDefault();return false}})}if(!r){p.on("keydown.toTextarea",function(t){if(!d(this).data().disabled&&t.ctrlKey){if(t.which===66||t.which===73||t.which===85){t.preventDefault();return false}}})}}})}}}};d(function(){var k=d("<style class='toTextarea-stylesheet'> .toTextarea { text-align: left; border: 1px solid #aaa; white-space: pre-wrap; word-wrap: break-word; padding: 1px; } .toTextarea-singleLine { white-space: pre; } .toTextarea-disabled { background-color: #eee; color: #555; } .toTextarea-placeholder:empty:after { color: #555; font-style: italic; cursor: text; content: attr(data-placeholder); }</style>");var l=d("head link[rel='stylesheet'], head style");if(l.length>0){l.eq(0).before(k)}else{d("head").append(k)}})})(jQuery,window,document);