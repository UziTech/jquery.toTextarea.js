(function(b,l,f,q){var r=function(e,d){var b=null;if(f.body.createTextRange!==q)b=f.body.createTextRange(),b.moveToPoint(e,d),b.select(),b=l.getSelection().getRangeAt(0);else if(f.createRange!==q)if(f.caretPositionFromPoint){var k=f.caretPositionFromPoint(e,d),b=f.createRange();b.setStart(k.offsetNode,k.offset);b.collapse(!0)}else f.caretRangeFromPoint&&(b=f.caretRangeFromPoint(e,d));return b},t=function(b){for(var d=b.length-1;0<=d;d--)if(0<b[d].childNodes.length){var f=t(b[d].childNodes);if(null!==
f)return f}else if(""!==b[d].data)return b[d];return null},p=function(e,d,g){var k=l.getSelection(),m=e.substring(e.length-1),h=b(this).text(),a=f.createTextNode("\n"),c=null,n=null;""!==h&&(c=h.substring(h.length-1),n=t(this.childNodes));m="\n"===m&&"\n"!==c&&(null===c||k.anchorNode===n&&k.anchorOffset===n.length||k.focusNode===n&&k.focusOffset===n.length);e=f.createTextNode(e);h=null;h=d!==q&&g!==q?r(d,g):k.getRangeAt(0);h.deleteContents();m&&h.insertNode(a);h.insertNode(e);h=f.createRange();h.setStartAfter(e);
h.collapse(!0);k.removeAllRanges();k.addRange(h)},u=function(e,d,f){var g=b(this),m=new FileReader;m.onload=function(b){var a=new Image;a.onload=function(){var a=l.getSelection(),b=r(d,f);null!==b?(b.insertNode(this),b.collapse(!1),a.removeAllRanges(),a.addRange(b)):g.is(":focus")?(b=a.getRangeAt(0),b.collapse(!1),b.insertNode(this),b.collapse(!1),a.removeAllRanges(),a.addRange(b)):g.append(this)};a.onerror=function(){alert("Not an image")};a.src=b.target.result};m.readAsDataURL(e)},g={allowHTML:!1,
allowImg:!1,singleLine:!1,pastePlainText:!0};b.fn.toTextarea=function(e){if("destroy"===e||!0===e)return this.each(function(){delete this.value;b(this).css({border:"","white-space":"",padding:""}).prop({contentEditable:!1}).off(".toTextarea").data({isTextarea:!1})});if("disable"===e)return this.css({"background-color":"#eee",color:"#555"}).prop({contentEditable:!1}).data({disabled:!0});if("enable"===e)return this.css({"background-color":"",color:""}).prop({contentEditable:!0}).data({disabled:!1});
b.isPlainObject(e)&&b.extend(g,e);return this.each(function(){var d=b(this);if(!d.data().isTextarea){this.hasOwnProperty("value")&&delete this.value;l.Object.defineProperty(this,"value",{configurable:!0,set:function(a){this.innerHTML=a},get:function(){return this.innerHTML}});var e=g.allowHTML;"function"===typeof g.allowHTML&&(e=g.allowHTML.call(this));var k=g.allowImg;"function"===typeof g.allowImg&&(k=g.allowImg.call(this));var m=g.singleLine;"function"===typeof g.singleLine&&(m=g.singleLine.call(this));
var h=g.pastePlainText;"function"===typeof g.pastePlainText&&(h=g.pastePlainText.call(this));d.css({border:"1px solid #aaa","white-space":m?"pre":"pre-wrap","word-wrap":"break-word",padding:"1px"}).prop({contentEditable:!0}).data({isTextarea:!0,disabled:!1}).on("select.toTextarea",function(){if(!b(this).data().disabled)if(f.body.createTextRange){var a=f.body.createTextRange();a.moveToElementText(this);a.select()}else if(l.getSelection){var c=l.getSelection(),a=f.createRange();a.selectNodeContents(this);
c.removeAllRanges();c.addRange(a)}});if(m)d.on("keypress.toTextarea",function(a){if(!b(this).data().disabled&&13===a.which)return a.preventDefault(),!1}),d.on("paste.toTextarea",function(a){if(!b(this).data().disabled){var c=null;if(l.clipboardData)c=l.clipboardData.getData("Text");else if(a.originalEvent.clipboardData)c=a.originalEvent.clipboardData.getData("text/plain");else return!0;c=c.replace(/[\n]/g," ");p.call(this,c);a.preventDefault();b(this).trigger("input");return!1}}).on("drop.toTextarea",
function(a){if(!b(this).data().disabled){var c=null,c=a.originalEvent.dataTransfer.getData("text/plain"),c=c.replace(/[\n]/g," ");p.call(this,c,a.originalEvent.clientX,a.originalEvent.clientY);a.preventDefault();b(this).trigger("input");return!1}});else if(d.on("keypress.toTextarea",function(a){if(!b(this).data().disabled&&13===a.which)return p.call(this,"\n"),a.preventDefault(),!1}),!e||h)d.on("paste.toTextarea",function(a){if(!b(this).data().disabled){var c=null;if(l.clipboardData)c=l.clipboardData.getData("Text");
else if(a.originalEvent.clipboardData)c=a.originalEvent.clipboardData.getData("text/plain");else return!0;p.call(this,c);a.preventDefault();b(this).trigger("input");return!1}}).on("drop.toTextarea",function(a){if(!b(this).data().disabled){var c=null,c=a.originalEvent.dataTransfer.getData("text/plain");p.call(this,c,a.originalEvent.clientX,a.originalEvent.clientY);a.preventDefault();b(this).trigger("input");return!1}});if(k)d.on("drop.toTextarea",function(a){if(!b(this).data().disabled&&0<a.originalEvent.dataTransfer.files.length){for(var c=
0,d=a.originalEvent.dataTransfer.files.length;c<d;c++)u.call(this,a.originalEvent.dataTransfer.files[c],a.originalEvent.clientX,a.originalEvent.clientY);a.preventDefault();b(this).trigger("input");return!1}}).on("dragover.toTextarea",function(a){if(!b(this).data().disabled&&0<a.originalEvent.dataTransfer.types.length&&"Files"===a.originalEvent.dataTransfer.types[0])return a.preventDefault(),!1});if(!e)d.on("keydown.toTextarea",function(a){if(!b(this).data().disabled&&a.ctrlKey&&a.which in{66:1,73:1})return a.preventDefault(),
!1})}})}})(jQuery,window,document);